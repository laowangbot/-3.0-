# 预设API配置测试程序使用说明

## 概述

已预设API配置的测试程序，无需设置环境变量，直接运行即可测试反查重功能。

## 预设配置

```
API_ID = 29112215
API_HASH = ddd2a2c75e3018ff6abf0aa4add47047
BOT_TOKEN = 8293428958:AAHKEGZN1dRWr0ubOT2rj32PJuFwDX49O-0
```

## 测试程序

### 1. preset_test.py - 简单测试程序

**特点：**
- 简单的参数输入
- 快速测试反查重功能
- 直接显示结果

**使用方法：**
```bash
python preset_test.py
```

**交互流程：**
```
源频道ID: -1001234567890
目标频道ID: -1001234567891
起始消息ID: 100
结束消息ID: 200
```

### 2. complete_preset_test.py - 完整测试程序

**特点：**
- 完整的用户交互界面
- 支持消息范围选择
- 可选择是否启用反查重
- 详细的测试过程和结果

**使用方法：**
```bash
python complete_preset_test.py
```

**交互流程：**
```
源频道ID (例如: -1001234567890): -1001234567890
目标频道ID (例如: -1001234567891): -1001234567891
起始消息ID (例如: 100): 100
结束消息ID (例如: 200): 200
是否启用反查重? (y/n): y
确认开始测试? (y/n): y
```

## 测试流程

### 1. 运行测试程序
选择其中一个程序运行：
```bash
# 简单测试
python preset_test.py

# 完整测试
python complete_preset_test.py
```

### 2. 输入参数
按照提示输入：
- 源频道ID
- 目标频道ID
- 消息ID范围

### 3. 观察结果
程序会自动：
- 获取指定范围的消息
- 测试反查重功能
- 尝试发送修改后的媒体组
- 显示测试结果

## 测试结果

### 成功情况
```
✅ 反查重测试成功
✅ 发送成功！反查重功能可行
   发送了 3 条消息
   消息ID: [67890, 67891, 67892]

✅ 建议实施文件ID修改功能
```

### 失败情况
```
❌ 发送失败: Invalid file_id
⚠️ 反查重功能不可行
建议使用简化方案：只重排序 + 修改标题
```

## 结果判断

### 如果测试成功
- 文件ID修改功能可行
- 可以实施完整的反查重方案
- 包括：重排序 + 文件ID修改

### 如果测试失败
- 文件ID修改功能不可行
- 建议使用简化方案
- 包括：只重排序 + 修改标题

## 测试示例

### 完整测试示例
```
🧪 完整预设API配置的反查重测试程序
============================================================
API_ID: 29112215
API_HASH: ddd2a2c75e3018ff6abf0aa4add47047
BOT_TOKEN: 8293428958:AAHKEGZN1dRWr0ubOT2rj32PJuFwDX49O-0
============================================================
✅ 客户端连接成功

📋 请输入测试参数:
------------------------------
源频道ID (例如: -1001234567890): -1001234567890
目标频道ID (例如: -1001234567891): -1001234567891
起始消息ID (例如: 100): 100
结束消息ID (例如: 200): 200
是否启用反查重? (y/n): y
确认开始测试? (y/n): y

📋 测试参数:
   源频道: -1001234567890
   目标频道: -1001234567891
   消息范围: 100-200
   反查重: 启用

📥 正在获取消息范围 100-200...
   找到媒体消息: 150 (图片)
   找到媒体消息: 175 (视频)
   找到媒体消息: 190 (图片)
✅ 找到 50 条消息，其中 3 条包含媒体

🧪 开始反查重测试...
   测试单个文件ID修改...
✅ 单个文件ID修改测试成功
   测试媒体组ID修改...
✅ 媒体组ID修改测试成功
   处理文件数: 3
   重新排序: True
   标识符修改: True

🎉 反查重测试通过，将使用反查重功能发送

📤 开始发送消息到目标频道...
✅ 发送媒体组成功 (反查重处理)
✅ 转发文本消息: 100
✅ 转发文本消息: 101
...

============================================================
🎉 测试完成!
   处理消息数: 50
   媒体消息数: 3
   发送成功: 50
   发送失败: 0
   反查重状态: ✅ 启用

✅ 建议实施文件ID修改功能
============================================================

📊 文件ID修改测试总结:
   总测试次数: 1
   成功次数: 1
   失败次数: 0
   成功率: 100.0%

✅ 客户端已断开
```

## 注意事项

1. **权限检查**：确保机器人有访问源频道和发送到目标频道的权限
2. **消息范围**：确保指定的消息ID范围内有媒体消息
3. **频率限制**：测试时会添加延迟避免触发频率限制
4. **测试环境**：建议在测试环境进行，避免影响生产数据

## 常见问题

### Q: 提示"Chat not found"
A: 检查频道ID是否正确，机器人是否有访问权限

### Q: 提示"Invalid file_id"
A: 文件ID修改功能不可行，建议使用简化方案

### Q: 没有找到媒体消息
A: 检查消息ID范围，确保范围内有包含媒体的消息

### Q: 发送失败
A: 检查目标频道权限，确保机器人有发送权限

## 后续步骤

### 测试成功后
1. 实施完整的反查重方案
2. 集成到搬运引擎
3. 添加用户界面控制

### 测试失败后
1. 实施简化反查重方案
2. 只使用重排序功能
3. 添加标题修改功能

## 联系支持

如果遇到问题：
1. 检查控制台错误信息
2. 确认频道权限
3. 验证消息ID范围
4. 联系技术支持




















