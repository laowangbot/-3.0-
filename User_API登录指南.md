# User API 登录指南

## 为什么需要 User API？

- ✅ **搬运评论区**：Bot API 无法访问频道的讨论组，必须使用 User API
- ✅ **更高权限**：User API 可以访问更多受限内容
- ✅ **更稳定**：避免 Bot API 的速率限制

---

## 登录步骤

### 1. 发送登录命令
向机器人发送：
```
/start_user_api_login
```

### 2. 输入手机号
机器人会要求输入手机号（带国家代码），例如：
```
+8613800138000
```

### 3. 输入验证码
Telegram 会向您的手机发送验证码，输入收到的验证码

### 4. 输入两步验证密码（如果有）
如果您启用了两步验证，需要输入密码

### 5. 验证登录状态
发送以下命令检查状态：
```
/user_api_status
```

应该显示：
```
✅ 已登录
✅ 客户端已连接
```

---

## 重要提示

### ⚠️ User API 用户必须加入：
1. **源频道**（您要搬运的频道）
2. **源频道的讨论组**（评论区所在的组）

### 如何找到并加入讨论组？
1. 在 Telegram 中打开源频道
2. 点击任意一条有评论的消息
3. 点击"查看评论"或"Comments"按钮
4. 加入该讨论组（点击 "Join"）

### 验证是否加入成功
- 打开源频道
- 点击一条消息的评论
- 如果能看到评论内容，说明已成功加入

---

## 登录后操作

登录成功后，**必须重启机器人**以切换到 User API 模式：

### Windows (本机)：
1. 停止当前运行的机器人（Ctrl+C）
2. 重新运行 `start_bot.bat`

### 服务器：
```bash
# 停止机器人
pkill -f "python lsjmain.py"

# 重启机器人
python lsjmain.py --bot esou_bot
```

---

## 验证 User API 模式

重启后，查看启动日志，应该看到：
```
🔧 使用 User API 初始化搬运引擎
✅ User API客户端已激活
```

如果看到这些日志，说明已成功切换到 User API 模式，现在可以搬运评论区了！

---

## 常见问题

### Q: 登录失败怎么办？
A: 使用 `/relogin_user_api` 重新开始登录流程

### Q: 忘记两步验证密码？
A: 需要在 Telegram 客户端中重置密码

### Q: 登录后还是无法搬运评论？
A: 检查以下几点：
1. ✅ User API 是否已登录（`/user_api_status`）
2. ✅ 机器人是否已重启
3. ✅ 启动日志是否显示 "使用 User API 初始化搬运引擎"
4. ✅ User API 用户是否已加入源频道和讨论组
5. ✅ 评论区搬运功能是否已在配置中启用

### Q: 如何退出 User API？
A: 使用命令：
```
/logout_user_api
```

---

## 安全提示

- 🔒 User API 会话是加密存储的
- 🔒 不要与他人分享您的会话文件
- 🔒 定期检查登录设备（Telegram 设置 → 隐私与安全 → 活跃会话）


