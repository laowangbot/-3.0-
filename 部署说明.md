# 双版本部署说明

## 📋 概述

本项目支持双版本部署：
- **本地开发版本** - 使用本地存储，便于开发和测试
- **Render生产版本** - 使用Firebase存储，适合生产环境

## 🔧 本地开发版本

### 启动方式
```bash
python start_local.py
```

### 配置要求
- 设置 `USE_LOCAL_STORAGE=true`
- 使用本地机器人token
- 数据存储在 `data/` 目录

### 环境变量示例
```bash
USE_LOCAL_STORAGE=true
BOT_ID=wang3.0_local
BOT_TOKEN=your_local_bot_token
API_ID=your_api_id
API_HASH=your_api_hash
```

## ☁️ Render生产版本

### 启动方式
```bash
python start_render.py
```

### 配置要求
- 设置 `USE_LOCAL_STORAGE=false` (默认)
- 使用生产机器人token
- 配置Firebase凭据

### 必需的环境变量
```bash
# 机器人配置
BOT_TOKEN=your_production_bot_token
API_ID=your_api_id
API_HASH=your_api_hash
BOT_ID=wang3.0_prod

# Firebase配置
FIREBASE_PROJECT_ID=your_firebase_project_id
FIREBASE_CREDENTIALS={"type":"service_account",...}

# Render配置
PORT=8080
RENDER_EXTERNAL_URL=https://your-app.onrender.com
```

## 🚀 Render部署步骤

### 1. 创建Render应用
1. 登录 [Render](https://render.com)
2. 创建新的 Web Service
3. 连接GitHub仓库

### 2. 配置环境变量
在Render控制台中设置以下环境变量：

**机器人配置：**
- `BOT_TOKEN` - 生产环境机器人token
- `API_ID` - Telegram API ID
- `API_HASH` - Telegram API Hash
- `BOT_ID` - 机器人ID (如: wang3.0_prod)

**Firebase配置：**
- `FIREBASE_PROJECT_ID` - Firebase项目ID
- `FIREBASE_CREDENTIALS` - Firebase服务账号JSON (完整JSON字符串)

**Render配置：**
- `PORT` - 端口 (默认8080)
- `RENDER_EXTERNAL_URL` - Render应用URL

### 3. 配置构建和启动命令
**构建命令：**
```bash
pip install -r requirements.txt
```

**启动命令：**
```bash
python start_render.py
```

### 4. 部署设置
- **实例类型**: Free 或 Starter
- **自动部署**: 开启
- **健康检查**: `/health`

## 🔄 双版本优势

### 本地开发版本
- ✅ 快速启动，无需Firebase配置
- ✅ 数据本地存储，便于调试
- ✅ 使用测试机器人token
- ✅ 适合功能开发和测试

### Render生产版本
- ✅ 云端部署，24/7运行
- ✅ Firebase存储，数据持久化
- ✅ 使用生产机器人token
- ✅ 适合正式用户使用

## 📊 监控和日志

### 本地版本
- 日志直接输出到控制台
- 数据文件在 `data/` 目录
- Web界面: http://localhost:8080

### Render版本
- 日志在Render控制台查看
- 数据存储在Firebase
- Web界面: https://your-app.onrender.com

## 🔧 故障排除

### 本地版本问题
1. **数据库锁定**: 重启应用或删除 `data/` 目录
2. **端口占用**: 修改 `PORT` 环境变量
3. **机器人token错误**: 检查 `.env` 文件配置

### Render版本问题
1. **Firebase连接失败**: 检查 `FIREBASE_CREDENTIALS` 格式
2. **环境变量缺失**: 在Render控制台检查所有必需变量
3. **构建失败**: 检查 `requirements.txt` 依赖

## 📝 注意事项

1. **机器人token分离**: 确保本地和生产使用不同的机器人token
2. **数据隔离**: 本地和生产数据完全独立
3. **配置同步**: 功能更新需要同时更新两个版本
4. **备份策略**: 定期备份Firebase数据

## 🎯 最佳实践

1. **开发流程**: 先在本地测试，确认无误后部署到Render
2. **版本管理**: 使用Git标签区分本地和生产版本
3. **监控告警**: 设置Render健康检查和告警
4. **数据迁移**: 需要时可以从本地数据迁移到Firebase

---

**创建时间**: 2025-01-02  
**版本**: v1.0  
**状态**: 生产就绪
